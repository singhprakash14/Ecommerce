<%- include('../partials/user-header')%>
    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="/" rel="nofollow">Home</a>
                    <span></span>
                    <%=product.category%>
                        <span></span>
                        <%=product.productName%>
                </div>
            </div>
        </div>
        <section class="mt-50 mb-50">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="product-detail accordion-detail">
                            <div class="row mb-50">
                                <div class="col-md-3 col-sm-12 col-xs-12">
                                    <div class="detail-gallery">
                                        <span class="zoom-icon"><i class="fi-rs-search"></i></span>
                                        <div class="product-image-slider">
                                            <% for(let i=0;i<product.productImage.length;i++){ %>
                                                <figure class="border-radius-10">
                                                    <img src="<%= product.productImage[i].path%>"
                                                        alt="product-image" class="img-fluid">
                                                </figure>
                                                <%}%>
                                        </div>
                                        <div class="slider-nav-thumbnails pl-15 pr-15">
                                            <% for(let i=0;i<product.productImage.length;i++){ %>
                                                <div><img
                                                        src="<%= product.productImage[i].path %>"
                                                        alt="product-image" class="img-fluid"></div>
                                                <%}%>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-9 col-sm-12 col-xs-12">
                                    <div class="detail-info">
                                        <h2 class="title-detail">
                                            <%=product.productName%>
                                        </h2>
                                        <div class="product-detail-rating">
                                            <div class="pro-details-brand">
                                                <span class="d-flex"> Brand : <a href=""
                                                        class="d-flex ms-2 justify-content-center">
                                                        <%=product.brand%>
                                                            <%if(brand){%>
                                                                <img src="<%= brand.brandImage.path %>"
                                                                    alt="brand-logo" height="32" class="ms-3">
                                                                <%}%>
                                                    </a>
                                                </span>
                                            </div>
                                            <div class="product-rate-cover text-end">
                                                <div class="product-rate d-inline-block">
                                                    <div class="product-rating" style="width:90%">
                                                    </div>
                                                </div>
                                                <span class="font-small ml-5 text-muted"> (25 reviews)</span>
                                            </div>
                                        </div>
                                        <div class="clearfix product-price-cover">
                                            <div class="product-price primary-color float-left">
                                                <ins><span class="text-brand">₹<%=product.salePrice%></span></ins>
                                                <ins><span class="old-price font-md ml-15">₹<%=product.regularPrice%>
                                                    </span></ins>
                                                <span
                                                    class="save-price  font-md color3 ml-15"><%=Math.round(100-((product.salePrice
                                                        /product.regularPrice)*100))%>%</span>
                                            </div>
                                        </div>
                                        <div class="bt-1 border-color-1 mt-15 mb-15"></div>
                                        <div class="short-desc mb-30">
                                            <p>
                                                <%=product.description%>
                                            </p>
                                        </div>
                                        <div class="product_sort_info font-xs mb-30">
                                            <ul>
                                                <li class="mb-10"><i class="fi-rs-crown mr-5"></i> 1 Year Brand Warranty
                                                </li>
                                                <li class="mb-10"><i class="fi-rs-refresh mr-5"></i> 30 Day Return
                                                    Policy</li>
                                                <li><i class="fi-rs-credit-card mr-5"></i> Cash on Delivery available
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="bt-1 border-color-1 mt-30 mb-30"></div>
                                        <div class="detail-extralink">
                                            <div class="detail-qty border radius">
                                                <a href="#" class="qty-down"><i class="fi-rs-angle-small-down"></i></a>
                                                <span class="qty-val">1</span>
                                                <a href="#" class="qty-up"><i class="fi-rs-angle-small-up"></i></a>
                                            </div>
                                            <div class="product-extra-link2">
                                                <button type="submit" class="button button-add-to-cart add-to-cart"
                                                    data-productId="<%=product._id%>">Add
                                                    to cart</button>
                                                <a aria-label="Add To Wishlist" class="action-btn hover-up add-to-wishlist" href="/" data-productId="<%=product._id%>"><i
                                                        class="fi-rs-heart"></i></a>
                                                <a aria-label="Compare" class="action-btn hover-up" href="/"><i
                                                        class="fi-rs-shuffle"></i></a>
                                            </div>
                                        </div>
                                        <ul class="product-meta font-xs color-grey mt-50">
                                            <li class="mb-5">Tags: <a href="#" rel="tag">
                                                    <%=product.brand%>,<%=product.productName%>
                                                </a>
                                            <li>Availability:<span class="in-stock text-success ml-5">
                                                    <%if(product.stock===true){%>
                                                        <%=product.units%> in stock
                                                            <%}else{%>
                                                                Out of Stock
                                                                <%}%>

                                                </span></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-10 m-auto entry-main-content">
                                    <h2 class="section-title style-1 mb-30">Description</h2>
                                    <div class="description mb-50">
                                        <p>
                                            <%=product.description%>
                                        </p>
                                        <!-- <ul class="product-more-infor mt-30">
                                            <li><span>Type Of Packing</span> Bottle</li>
                                            <li><span>Color</span> Green, Pink, Powder Blue, Purple</li>
                                            <li><span>Quantity Per Case</span> 100ml</li>
                                            <li><span>Ethyl Alcohol</span> 70%</li>
                                            <li><span>Piece In One</span> Carton</li>
                                        </ul> -->
                                        <hr class="wp-block-separator is-style-dots">
                                        <!-- <p>Laconic overheard dear woodchuck wow this outrageously taut beaver hey hello far meadowlark imitatively egregiously hugged that yikes minimally unanimous pouted flirtatiously as beaver beheld above forward
                                            energetic across this jeepers beneficently cockily less a the raucously that magic upheld far so the this where crud then below after jeez enchanting drunkenly more much wow callously irrespective limpet.</p> -->
                                        <!-- <h4 class="mt-30">Packaging & Delivery</h4>
                                        <hr class="wp-block-separator is-style-wide">
                                        <p>Less lion goodness that euphemistically robin expeditiously bluebird smugly scratched far while thus cackled sheepishly rigid after due one assenting regarding censorious while occasional or this more crane
                                            went more as this less much amid overhung anathematic because much held one exuberantly sheep goodness so where rat wry well concomitantly.
                                        </p>
                                        <p>Scallop or far crud plain remarkably far by thus far iguana lewd precociously and and less rattlesnake contrary caustic wow this near alas and next and pled the yikes articulate about as less cackled dalmatian
                                            in much less well jeering for the thanks blindly sentimental whimpered less across objectively fanciful grimaced wildly some wow and rose jeepers outgrew lugubrious luridly irrationally attractively
                                            dachshund.
                                        </p> -->
                                    </div>
                                    <h3 class="section-title style-1 mb-30">Additional info</h3>
                                    <table class="font-md mb-30">
                                        <tbody>
                                            <tr class="screen-size">
                                                <th>Screen Size</th>
                                                <td>
                                                    <p>
                                                        <%=product.screenSize%> Inch (
                                                            <%=Math.round(product.screenSize*2.54)%> cm)
                                                    </p>
                                                </td>
                                            </tr>
                                            <tr class="operating-system">
                                                <th>Operating System</th>
                                                <td>
                                                    <p>
                                                        <%=product.operatingSystem%>
                                                    </p>
                                                </td>
                                            </tr>
                                            <tr class="cellular-technology">
                                                <th>Cellular Technology</th>
                                                <td>
                                                    <p>
                                                        <%=product.cellularTechnology%>
                                                    </p>
                                                </td>
                                            </tr>
                                            <tr class="internal-memory">
                                                <th>Internal Memory</th>
                                                <td>
                                                    <p>
                                                        <%=product.internalMemory%> GB
                                                    </p>
                                                </td>
                                            </tr>
                                            <tr class="ram">
                                                <th>RAM</th>
                                                <td>
                                                    <p>
                                                        <%=product.ram%> GB
                                                    </p>
                                                </td>
                                            </tr>
                                            <tr class="battery-capacity">
                                                <th>Battery Capacity</th>
                                                <td>
                                                    <p>
                                                        <%=product.batteryCapacity%> Mah
                                                    </p>
                                                </td>
                                            </tr>
                                            <tr class="processor">
                                                <th>Processor</th>
                                                <td>
                                                    <p>
                                                        <%=product.processor%>
                                                    </p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div class="social-icons single-share">
                                        <ul class="text-grey-5 d-inline-block">
                                            <li><strong class="mr-10">Share this:</strong></li>
                                            <li class="social-facebook"><a href="#"><img
                                                        src="user-assets//imgs/theme/icons/icon-facebook.svg"
                                                        alt=""></a></li>
                                            <li class="social-twitter"> <a href="#"><img
                                                        src="user-assets//imgs/theme/icons/icon-twitter.svg" alt=""></a>
                                            </li>
                                            <li class="social-instagram"><a href="#"><img
                                                        src="user-assets//imgs/theme/icons/icon-instagram.svg"
                                                        alt=""></a></li>
                                            <li class="social-linkedin"><a href="#"><img
                                                        src="user-assets//imgs/theme/icons/icon-pinterest.svg"
                                                        alt=""></a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </section>
        <input type="hidden" data-isLogin="<%=isLogin%>" class="isLogin">
    </main>

    <script>
        var isLogin= document.querySelector('.isLogin').getAttribute('data-isLogin')

        document.querySelector('.qty-up').addEventListener('click', (event) => {
            event.preventDefault();
            var quantityElement = document.querySelector('.qty-val');
            var quantity = parseInt(quantityElement.textContent, 10);
            quantity += 1;
            quantityElement.textContent = quantity; 
        });

        document.querySelector('.qty-down').addEventListener('click', (event) => {
            event.preventDefault();
            var quantityElement = document.querySelector('.qty-val');
            var quantity = parseInt(quantityElement.textContent, 10);
            if (quantity > 1) {
                quantity -= 1;
                quantityElement.textContent = quantity; 
            }
        });

        document.querySelectorAll('.add-to-cart').forEach(element => {
            element.addEventListener('click', (event) => {
                event.preventDefault();
                if(isLogin){
                    var productId = element.getAttribute('data-productId')
                var quantity = document.querySelector('.qty-val').textContent;
                fetch(`/cart`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        productId: productId,
                        quantity: Number(quantity)
                    })
                }).then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json() 
                })
                    .then(data => {
                        Swal.fire({
                            position: 'top-end',
                            icon: 'success',
                            title: 'Added to Cart',
                            showConfirmButton: false,
                            timer: 1500
                        })
                        console.log('Data updated successfully:', data);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
                } else {
                    Swal.fire({
          icon: 'error',
          title: 'Please Login',
          text: 'You Need to Login in order to Add to Cart',
          footer: '<a href="/signin">Login Page?</a>'
        })
                }
            })
        });

        document.querySelectorAll('.add-to-wishlist').forEach(element => {
      element.addEventListener('click', (event) => {
        event.preventDefault();
        if(isLogin){
            var productId = element.getAttribute('data-productId')
        fetch(`/wishlist`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            productId: productId,
          })
        }).then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json() 
        })
          .then(data => {
            Swal.fire({
                    position: 'top-end',
                    icon: 'success',
                    title: 'Added to Wishlist',
                    showConfirmButton: false,
                    timer: 1500
                })
            console.log('Data updated successfully:', data);
          })
          .catch(error => {
            console.error('Error:', error);
          });
        } else {
            Swal.fire({
          icon: 'error',
          title: 'Please Login',
          text: 'You Need to Login in order to Add to Wishlist',
          footer: '<a href="/signin">Login Page?</a>'
        })
        }
      })
    });

    </script>
    <%-include('../partials/user-footer')%>