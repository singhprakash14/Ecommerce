<%- include('../partials/user-header')%>

  <main class="main">
    <%if(banners){%>
      <section class="home-slider position-relative pt-50">
        <div class="hero-slider-1 dot-style-1 dot-style-1-position-1">
          <%banners.forEach((banner)=>{%>
            <%if(banner.endDate> Date.now()){%>
        <div class="single-hero-slider single-animation-wrap">
          <div class="container">
            <div class="row align-items-center slider-animated-1">
              <div class="col-lg-5 col-md-6">
                <div class="hero-slider-content-2">
                  <h4 class="animated">Trade-in offer</h4>
                  <h4 class="animated fw-900">Offer Till &nbsp;:&nbsp; <%=moment(banner.startDate).format('MMMM Do YYYY')%></h4>
                  <h1 class="animated fw-900 text-brand"><%=banner.description%></h1>
                  <!-- <p class="animated">Save more with coupons & up to 70% off</p> -->
                  <a class="animated btn btn-brush btn-brush-3" href="/products">
                    Shop Now
                  </a>
                </div>
              </div>
              <div class="col-lg-7 col-md-6">
                <div class="single-slider-img single-slider-img-1">
                  <!-- <img class="animated slider-1-1" src="user-assets/imgs/slider/slider-1.png" alt=""> -->
                  <img class="animated slider-1-1"
                    src="<%=banner.bannerImage.path%>"
                    alt="" />
                </div>
              </div>
            </div>
          </div>
        </div>
        <%}%>
        <%})%>
      </div>
      <div class="slider-arrow hero-slider-1-arrow"></div>
    </section>
    <%}%>
    <section class="featured section-padding position-relative">
      <div class="container">
        <div class="row">
          <div class="col-lg-2 col-md-4 mb-md-3 mb-lg-0">
            <div class="banner-features wow fadeIn animated hover-up">
              <img src="user-assets/imgs/theme/icons/feature-1.png" alt="" />
              <h4 class="bg-1">Free Delivery</h4>
            </div>
          </div>
          <div class="col-lg-2 col-md-4 mb-md-3 mb-lg-0">
            <div class="banner-features wow fadeIn animated hover-up">
              <img src="user-assets/imgs/theme/icons/feature-2.png" alt="" />
              <h4 class="bg-3">Online Order</h4>
            </div>
          </div>
          <div class="col-lg-2 col-md-4 mb-md-3 mb-lg-0">
            <div class="banner-features wow fadeIn animated hover-up">
              <img src="user-assets/imgs/theme/icons/feature-3.png" alt="" />
              <h4 class="bg-2">Save Money</h4>
            </div>
          </div>
          <div class="col-lg-2 col-md-4 mb-md-3 mb-lg-0">
            <div class="banner-features wow fadeIn animated hover-up">
              <img src="user-assets/imgs/theme/icons/feature-4.png" alt="" />
              <h4 class="bg-4">Guarantee</h4>
            </div>
          </div>
          <div class="col-lg-2 col-md-4 mb-md-3 mb-lg-0">
            <div class="banner-features wow fadeIn animated hover-up">
              <img src="user-assets/imgs/theme/icons/feature-5.png" alt="" />
              <h4 class="bg-5">Brands</h4>
            </div>
          </div>
          <div class="col-lg-2 col-md-4 mb-md-3 mb-lg-0">
            <div class="banner-features wow fadeIn animated hover-up">
              <img src="user-assets/imgs/theme/icons/feature-6.png" alt="" />
              <h4 class="bg-6">24/7 Support</h4>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="product-tabs section-padding position-relative wow fadeIn animated">
      <div class="bg-square"></div>
      <div class="container">
        <div class="tab-header">
          <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="nav-tab-one" data-bs-toggle="tab" data-bs-target="#tab-one"
                type="button" role="tab" aria-controls="tab-one" aria-selected="true">
                Featured
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="nav-tab-two" data-bs-toggle="tab" data-bs-target="#tab-two" type="button"
                role="tab" aria-controls="tab-two" aria-selected="false">
                Popular
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="nav-tab-three" data-bs-toggle="tab" data-bs-target="#tab-three" type="button"
                role="tab" aria-controls="tab-three" aria-selected="false">
                New added
              </button>
            </li>
          </ul>
          <a href="/products" class="view-more d-none d-md-flex">View More<i
              class="fi-rs-angle-double-small-right"></i></a>
        </div>
        <!--End nav-tabs-->
        <div class="tab-content wow fadeIn animated" id="myTabContent">
          <div class="tab-pane fade show active" id="tab-one" role="tabpanel" aria-labelledby="tab-one">
            <div class="row product-grid-4">
              <%if(products){%>
                <% products.filter(product=>
                  !product.isBlocked).forEach(function(product) { %>
                  <div class="col-lg-3 col-md-4 col-12 col-sm-6">
                    <div class="product-cart-wrap mb-30">
                      <div class="product-img-action-wrap">
                        <div class="product-img product-img-zoom">
                          <a href="/product?id=<%=product._id%>">
                            <img class="default-img"
                              src="<%= product.productImage[0].path%>"
                              alt="" />
                            <img class="hover-img"
                              src="<%= product.productImage[0].path %>"
                              alt="" />
                          </a>
                        </div>
                        <div class="product-action-1">
                          <!-- <a aria-label="Quick view" class="action-btn hover-up" data-bs-toggle="modal"
                            data-bs-target="#quickViewModal"><i class="fi-rs-eye"></i></a> -->
                          <a aria-label="Add To Wishlist" class="action-btn hover-up add-to-wishlist" href="" data-productId="<%=product._id%>"><i
                              class="fi-rs-heart"></i></a>
                          <!-- <a aria-label="Compare" class="action-btn hover-up" href=""><i class="fi-rs-shuffle"></i></a> -->
                        </div>
                        <div class="product-badges product-badges-position product-badges-mrg">
                          <span class="hot">Hot</span>
                        </div>
                      </div>
                      <div class="product-content-wrap">
                        <div class="product-category">
                          <a href="">
                            <%=product.brand%>
                          </a>
                        </div>
                        <h2><a href="">
                            <%=product.productName%>
                          </a></h2>
                        <div class="rating-result" title="90%">
                          <span>
                            <span><%=Math.round(100-((product.salePrice /product.regularPrice)*100))%>%</span>
                          </span>
                        </div>
                        <div class="product-price">
                          <span>
                            ₹<%=product.salePrice%>
                          </span>
                          <span class="old-price">
                            ₹<%=product.regularPrice%>
                          </span>
                        </div>
                        <div class="product-action-1 show">
                          <a aria-label="Add To Cart" class="action-btn hover-up add-to-cart"
                            data-productId="<%=product._id%>"><i class="fi-rs-shopping-bag-add"></i></a>
                        </div>
                      </div>
                    </div>
                  </div>
                  <%})%>
                    <%}else{%>
                      <h3>No Products Found</h3>
                      <%}%>
            </div>
            <!--End product-grid-4-->
          </div>
          <!--En tab one (Featured)-->
          <div class="tab-pane fade" id="tab-two" role="tabpanel" aria-labelledby="tab-two">
            <div class="row product-grid-4">
              <%if(products){%>
                <% products.filter(product=>
                  !product.isBlocked).forEach(function(product) { %>
                  <div class="col-lg-3 col-md-4 col-12 col-sm-6">
                    <div class="product-cart-wrap mb-30">
                      <div class="product-img-action-wrap">
                        <div class="product-img product-img-zoom">
                          <a href="/product?id=<%=product._id%>">
                            <img class="default-img"
                              src="<%= product.productImage[0].path %>"
                              alt="" />
                            <img class="hover-img"
                              src="<%= product.productImage[0].path %>"
                              alt="" />
                          </a>
                        </div>
                        <div class="product-action-1">
                          <!-- <a aria-label="Quick view" class="action-btn hover-up" data-bs-toggle="modal"
                            data-bs-target="#quickViewModal"><i class="fi-rs-eye"></i></a> -->
                          <a aria-label="Add To Wishlist" class="action-btn hover-up add-to-wishlist" href="" data-productId="<%=product._id%>"><i
                              class="fi-rs-heart"></i></a>
                          <!-- <a aria-label="Compare" class="action-btn hover-up" href=""><i class="fi-rs-shuffle"></i></a> -->
                        </div>
                        <div class="product-badges product-badges-position product-badges-mrg">
                          <span class="hot">Hot</span>
                        </div>
                      </div>
                      <div class="product-content-wrap">
                        <div class="product-category">
                          <a href="">
                            <%=product.brand%>
                          </a>
                        </div>
                        <h2><a href="">
                            <%=product.productName%>
                          </a></h2>
                        <div class="rating-result" title="90%">
                          <span>
                            <span><%=Math.round(100-((product.salePrice /product.regularPrice)*100))%>%</span>
                          </span>
                        </div>
                        <div class="product-price">
                          <span>
                            ₹<%=product.salePrice%>
                          </span>
                          <span class="old-price">
                            ₹<%=product.regularPrice%>
                          </span>
                        </div>
                        <div class="product-action-1 show">
                          <a aria-label="Add To Cart" class="action-btn hover-up add-to-cart"
                            data-productId="<%=product._id%>"><i class="fi-rs-shopping-bag-add"></i></a>
                        </div>
                      </div>
                    </div>
                  </div>
                  <%})%>
                    <%}else{%>
                      <h3>No Products Found</h3>
                      <%}%>
            </div>
            <!--End product-grid-4-->
          </div>
          <!--En tab two (Popular)-->
          <div class="tab-pane fade" id="tab-three" role="tabpanel" aria-labelledby="tab-three">
            <div class="row product-grid-4">
              <%if(products){%>
                <% products.filter(product=>
                  !product.isBlocked).forEach(function(product) { %>
                  <div class="col-lg-3 col-md-4 col-12 col-sm-6">
                    <div class="product-cart-wrap mb-30">
                      <div class="product-img-action-wrap">
                        <div class="product-img product-img-zoom">
                          <a href="/product?id=<%=product._id%>">
                            <img class="default-img"
                              src="<%= product.productImage[0].path %>"
                              alt="" />
                            <img class="hover-img"
                              src="<%= product.productImage[0].path %>"
                              alt="" />
                          </a>
                        </div>
                        <div class="product-action-1">
                          <a aria-label="Quick view" class="action-btn hover-up" data-bs-toggle="modal"
                            data-bs-target="#quickViewModal"><i class="fi-rs-eye"></i></a>
                          <a aria-label="Add To Wishlist" class="action-btn hover-up add-to-wishlist" href="" data-productId="<%=product._id%>"><i
                              class="fi-rs-heart"></i></a>
                          <a aria-label="Compare" class="action-btn hover-up" href=""><i class="fi-rs-shuffle"></i></a>
                        </div>
                        <div class="product-badges product-badges-position product-badges-mrg">
                          <span class="hot">Hot</span>
                        </div>
                      </div>
                      <div class="product-content-wrap">
                        <div class="product-category">
                          <a href="">
                            <%=product.brand%>
                          </a>
                        </div>
                        <h2><a href="">
                            <%=product.productName%>
                          </a></h2>
                        <div class="rating-result" title="90%">
                          <span>
                            <span><%=Math.round(100-((product.salePrice /product.regularPrice)*100))%>%</span>
                          </span>
                        </div>
                        <div class="product-price">
                          <span>
                            ₹<%=product.salePrice%>
                          </span>
                          <span class="old-price">
                            ₹<%=product.regularPrice%>
                          </span>
                        </div>
                        <div class="product-action-1 show">
                          <a aria-label="Add To Cart" class="action-btn hover-up add-to-cart"
                            data-productId="<%=product._id%>"><i class="fi-rs-shopping-bag-add"></i></a>
                        </div>
                      </div>
                    </div>
                  </div>
                  <%})%>
                    <%}else{%>
                      <h3>No Products Found</h3>
                      <%}%>
            </div>
            <!--End product-grid-4-->
          </div>
          <!--En tab three (New added)-->
        </div>
        <!--End tab-content-->
      </div>
    </section>
    <!-- <section class="banner-2 section-padding pb-0">
    <div class="container">
      <div class="banner-img banner-big wow fadeIn animated f-none">
        <img src="user-assets/imgs/banner/banner-4.png" alt="" />
        <div class="banner-text d-md-block d-none">
          <h4 class="mb-15 mt-40 text-brand">Repair Services</h4>
          <h1 class="fw-600 mb-20">
            We're an Apple <br />Authorised Service Provider
          </h1>
          <a href="shop-grid-left.html" class="btn"
            >Learn More <i class="fi-rs-arrow-right"></i
          ></a>
        </div>
      </div>
    </div>
  </section>
  <section class="banners mb-15">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 col-md-6">
          <div class="banner-img wow fadeIn animated">
            <img src="user-assets/imgs/banner/banner-1.png" alt="" />
            <div class="banner-text">
              <span>Smart Offer</span>
              <h4>Save 20% on <br />Woman Bag</h4>
              <a href="shop-grid-right.html"
                >Shop Now <i class="fi-rs-arrow-right"></i
              ></a>
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-md-6">
          <div class="banner-img wow fadeIn animated">
            <img src="user-assets/imgs/banner/banner-2.png" alt="" />
            <div class="banner-text">
              <span>Sale off</span>
              <h4>Great Summer <br />Collection</h4>
              <a href="shop-grid-right.html"
                >Shop Now <i class="fi-rs-arrow-right"></i
              ></a>
            </div>
          </div>
        </div>
        <div class="col-lg-4 d-md-none d-lg-flex">
          <div class="banner-img wow fadeIn animated mb-sm-0">
            <img src="user-assets/imgs/banner/banner-3.png" alt="" />
            <div class="banner-text">
              <span>New Arrivals</span>
              <h4>Shop Today’s <br />Deals & Offers</h4>
              <a href="shop-grid-right.html"
                >Shop Now <i class="fi-rs-arrow-right"></i
              ></a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section> -->
    <section class="section-padding">
      <div class="container">
        <h3 class="section-title mb-20 wow fadeIn animated">
          <span>Featured</span> Brands
        </h3>
        <div class="carausel-6-columns-cover position-relative wow fadeIn animated">
          <div class="slider-arrow slider-arrow-2 carausel-6-columns-arrow" id="carausel-6-columns-3-arrows"></div>
          <div class="carausel-6-columns text-center" id="carausel-6-columns-3">
            <%if(brands){%>
              <%brands.forEach((brand)=>{%>
                <div class="brand-logo">
                  <img
                    src="<%= brand.brandImage.path %>"
                    alt="brand-logo" height="72" />
                </div>
                <%})%>
                  <%} else {%>
                    <div class="brand-logo">
                      <h4>No Brands</h4>
                    </div>
                    <%}%>
          </div>
        </div>
      </div>
    </section>
    <input type="hidden" data-isLogin="<%=isLogin%>" class="isLogin">
  </main>

  <script>
    var isLogin= document.querySelector('.isLogin').getAttribute('data-isLogin')

    document.querySelectorAll('.add-to-cart').forEach(element => {
      element.addEventListener('click', (event) => {
        event.preventDefault();
        if(isLogin){
          var productId = element.getAttribute('data-productId')
        fetch(`/cart`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            productId: productId,
            quantity: 1
          })
        }).then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json()
        })
          .then(data => {
            Swal.fire({
              position: 'top-end',
              icon: 'success',
              title: 'Added to Cart',
              showConfirmButton: false,
              timer: 1500
            })
            console.log('Data updated successfully:', data);
          })
          .catch(error => {
            console.error('Error:', error);
          });
      } else {
        Swal.fire({
          icon: 'error',
          title: 'Please Login',
          text: 'You Need to Login in order to Add to Cart',
          footer: '<a href="/signin">Login Page?</a>'
        })
      }
      })
    });


    document.querySelectorAll('.add-to-wishlist').forEach(element => {
      element.addEventListener('click', (event) => {
        event.preventDefault();
        if(isLogin){
          var productId = element.getAttribute('data-productId')
        fetch(`/wishlist`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            productId: productId,
          })
        }).then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json() 
        })
          .then(data => {
            Swal.fire({
              position: 'top-end',
              icon: 'success',
              title: 'Added to Wishlist',
              showConfirmButton: false,
              timer: 1500
            })
            console.log('Data updated successfully:', data);
          })
          .catch(error => {
            console.error('Error:', error);
          });
        } else {
          Swal.fire({
          icon: 'error',
          title: 'Please Login',
          text: 'You Need to Login in order to Add to Wishlist',
          footer: '<a href="/signin">Login Page?</a>'
        })
        }
      })
    });

  </script>

  <%-include('../partials/user-footer')%>